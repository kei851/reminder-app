# リマインダーシステム

柔軟なリマインド設定と Slack スレッド対応のリマインダーシステム

## ファイル構成

メンテナンス性を重視した4ファイル構成：

- **config.js** - Slackトークンとシート参照の設定
- **daily_do.js** - メイン処理（リマインダー実行、テスト、トリガー設定）
- **post_message.js** - Slackメッセージ投稿とスレッド管理
- **util.js** - ユーティリティ関数（データ処理、日付計算）

## セットアップ

### 1. Google Sheets の準備

以下の 4 つのシートを作成：

#### リマインダー設定

| A 列         | B 列     | C 列                   | D 列       | E 列           |
| ------------ | -------- | ---------------------- | ---------- | -------------- |
| 本番の日付   | 名前     | リマインドするメッセージ | チャンネル | スレッドリンク |
| 2025-06-29   | 大西啓太 | 遺伝志発信（30日前）   | 13_遺伝志発信 | (自動入力)     |

#### すべてのslackメンバー

| A 列     | B 列          | C 列      | D 列  | E 列         |
| -------- | ------------- | --------- | ----- | ------------ |
| id       | name          | name_only | flag  | name_26only  |
| U1234567 | 門凜華_I      | 門凜華    | 1     | 門凜華       |

#### リマインド文マスター

| A 列                 | B 列       | C 列     | D 列                                    | E 列               | F 列     |
| -------------------- | ---------- | -------- | --------------------------------------- | ------------------ | -------- |
| リマインダー名       | セット名   | タイミング | 文章                                   | デフォルトチャンネル | 送信時間 |
| 遺伝志発信（30日前） | 遺伝志発信 | 30日前   | 遺伝志休暇発信まであと1ヶ月です！      | 13_遺伝志発信       | 9        |
| 遺伝志発信（21日前） | 遺伝志発信 | 21日前   | 下書きを書きましょう！                  | 13_遺伝志発信       | 14       |

#### 全てのチャンネル

| A 列         | B 列              |
| ------------ | ----------------- |
| id           | name              |
| C07NRAPT55G  | 10_general        |
| C089JMCBB6K  | 25_pitch会        |
| C088DTK6R0Q  | 13_遺伝志発信     |

**メッセージのテンプレート変数**:

- `{DEADLINE}` - 自動で期日詳細に置換
  - 例: 「明日（6 月 24 日）の 24 時まで」
  - 例: 「3 日後（6 月 26 日）の 24 時まで」

### 2. Google Apps Script の設定

1. **新しいGASプロジェクトを作成**
2. **4つのファイルを順番にコピー**：
   - `config.js` の内容をコピーして、`token` と `channelId` を設定
   - `util.js` の内容をコピー
   - `post_message.js` の内容をコピー
   - `daily_do.js` の内容をコピー
3. **トリガーを設定**：
   - `setupHourlyTrigger()` 関数を1回実行（1時間ごとに自動実行設定）

## 使い方

### 遺伝志発信の場合

1. **リマインド文マスターに遺伝志発信の設定を追加**：

```
遺伝志発信（30日前） | 遺伝志発信 | 30日前 | 遺伝志休暇発信まであと1ヶ月です！ | 13_遺伝志発信 | 9
遺伝志発信（21日前） | 遺伝志発信 | 21日前 | 下書きを書きましょう！ | 13_遺伝志発信 | 14
遺伝志発信（7日前）  | 遺伝志発信 | 7日前  | 上長に最終レビューを依頼しましょう！ | 13_遺伝志発信 | 10
遺伝志発信（3日前）  | 遺伝志発信 | 3日前  | 送信する文章が完成していることを確認し、当日出社できない場合は事前約束信頼します！ | 13_遺伝志発信 | 16
```

2. **リマインダー設定に対象者を登録**：

```
2025-07-15 | 大西啓太 | 遺伝志発信（30日前） | 13_遺伝志発信
```

3. **自動で以下が実行される**：
   - 30 日前の9時：1ヶ月前リマインド（スレッド開始）
   - 21 日前の14時：下書きリマインド（スレッド返信）
   - 7 日前の10時：上長レビューリマインド（スレッド返信）
   - 3 日前の16時：最終確認リマインド（スレッド返信）

### その他のリマインド

1. **リマインド文マスターに新しいリマインダーを追加**：

```
提出物リマインド | 個人用 | 7日前 | 📋 提出を{DEADLINE}にお願いします | 10_general | 11
```

2. **リマインダー設定に対象者を登録**：

```
2025-08-01 | 山田太郎 | 提出物リマインド | 10_general
```

## 機能

- **リマインダー別時間設定**: リマインダーごとに送信時間を指定可能（F列）
- **1時間ごと自動チェック**: GASが1時間ごとに実行し、該当時間のリマインダーのみ送信
- **期日同じ人自動まとめ**: 同じ期日の人が自動的にグループ化される
- **柔軟なスレッド機能**: スレッドリンクがある場合は自動でスレッドに返信、ない場合は新規投稿
- **スレッドリンク自動記録**: E列にSlackスレッドURLが自動で記録される
- **チャンネル名管理**: 全てのチャンネルマスターからIDを自動取得
- **チャンネル優先順位**: 個人設定 > マスターのデフォルト > config.jsのdefault
- **プルダウン対応**: nameで設定、IDは自動変換
- **完全スプレッドシート管理**: すべての設定がスプレッドシートで変更可能

## テスト

- `testReminder()` - 現在の時間で実行されるリマインダーをテスト
- `testReminderAtHour(時間)` - 指定した時間のリマインダーをテスト（例：`testReminderAtHour(14)`）

## 重要：コード内にハードコードなし

**すべての設定がスプレッドシートで管理されています。**
- リマインダーの内容変更 → リマインド文マスターを編集
- 期日・対象者変更 → リマインダー設定を編集
- チャンネル変更 → リマインダー設定またはリマインド文マスターを編集
- 新しいチャンネル追加 → 全てのチャンネルマスターに追加

**コードを触る必要は一切ありません！**

## 📖 使用者向けガイド

**実際に使用する方は [USER_GUIDE.md](USER_GUIDE.md) をご覧ください**

- ステップバイステップの使い方
- 実行時間の変更方法  
- 実際の動作例
- よくある質問と回答
- 使用のコツ