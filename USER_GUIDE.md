# リマインダーシステム 使用者ガイド

## 📋 このシステムでできること

- **自動リマインド**: 指定した日の ◯ 日前に自動で Slack にメンション付きリマインドを送信
- **柔軟なスレッド管理**: スレッドリンクがある場合は自動でスレッドに返信、ない場合は新規投稿
- **複数人対応**: 同じ期日の人を自動でまとめてメンション
- **柔軟なチャンネル設定**: 個人別・リマインダー別にチャンネルを指定可能

## 🚀 基本的な使い方

### Step 1: リマインダーの内容を設定する

**「リマインド文マスター」シートを開く**

| A 列（リマインダー名） | B 列（セット名） | C 列（タイミング） | D 列（文章）                    | E 列（デフォルトチャンネル） | F 列（送信時間） |
| ---------------------- | ---------------- | ------------------ | ------------------------------- | ---------------------------- | ---------------- |
| 遺伝志発信（30 日前）  | 遺伝志発信       | 30 日前            | 遺伝志発信まであと 1 ヶ月です！ | 13\_遺伝志発信               | 9                |

**記入例:**

```
遺伝志発信（30日前） | 遺伝志発信 | 30日前 | 遺伝志発信まであと1ヶ月です！{DEADLINE} | 13_遺伝志発信 | 9
遺伝志発信（21日前） | 遺伝志発信 | 21日前 | 下書きを書きましょう！{DEADLINE} | 13_遺伝志発信 | 14
提出物リマインド | 個人用 | 7日前 | 📋 提出をお願いします。{DEADLINE} | 10_general | 11
```

💡 **ポイント:**

- `{DEADLINE}` と書くと、自動で「3 日後（7 月 15 日）の 24 時まで」のような文章に置き換わります
- セット名を同じにすると、関連するリマインダーがまとめて管理されます
- **F列の送信時間**：そのリマインダーを送信する時間（24時間形式：9=9時、14=14時）

### Step 2: 対象者とスケジュールを設定する

**「リマインダー設定」シートを開く**

| A 列（本番の日付） | B 列（名前） | C 列（リマインドするメッセージ） | D 列（チャンネル） | E 列（スレッドリンク） |
| ------------------ | ------------ | -------------------------------- | ------------------ | ---------------------- |
| 2025-07-15         | 大西啓太     | 遺伝志発信（30 日前）            | 13\_遺伝志発信     | (自動入力)             |

**記入例:**

```
2025-07-15 | 大西啓太 | 遺伝志発信（30日前） | 13_遺伝志発信
2025-07-15 | 田中太郎 | 遺伝志発信（30日前） | 13_遺伝志発信
2025-08-01 | 山田花子 | 提出物リマインド | 10_general
```

💡 **ポイント:**

- C 列は「リマインド文マスター」で作ったリマインダー名をプルダウンから選択
- D 列は「全てのチャンネル」で管理されているチャンネル名をプルダウンから選択
- E 列は自動で入力されるので触る必要なし

## 🕐 実行時間の設定

### 現在の仕組み

システムは **1時間ごと** に自動実行され、その時間に送信するべきリマインダーをチェックします。

### 初回セットアップ（GAS設定）

Google Apps Script で以下の関数を **1 回だけ** 実行してください：

```javascript
setupHourlyTrigger(); // 1時間ごとに自動実行を設定
```

これで GAS が 1 時間ごとに `hourlyCheck()` を実行し、リマインダーマスターの F 列で指定された時間にリマインダーを送信します。

### 個別リマインダーの時間設定

**リマインダーごとの送信時間は「リマインド文マスター」の F 列で設定**

| リマインダー名 | 送信時間 | 実際の送信時刻 |
|------------|------|------------|
| 遺伝志発信（30日前） | 9 | 毎日9時台 |
| 遺伝志発信（21日前） | 14 | 毎日14時台 |
| 提出物リマインド | 11 | 毎日11時台 |

💡 **メリット**：
- 朝のチャンネル混雑を回避
- 重要度に応じた時間設定
- リマインダーごとに最適な時間を選択可能

## 📝 実際の動作例

### 遺伝志発信の場合（スレッド機能あり）

**設定:**

```
期日: 2025-07-15
名前: 大西啓太, 田中太郎
リマインダー: 遺伝志発信（30日前）
```

**結果:**

- 2025-06-15（30 日前）の **9時台** に `13_遺伝志発信` チャンネルに投稿（スレッド開始）
- 2025-06-24（21 日前）の **14時台** に同じスレッドに返信
- 2025-07-08（7 日前）の **10時台** に同じスレッドに返信  
- 2025-07-12（3 日前）の **16時台** に同じスレッドに返信
- メッセージ例: `<@大西啓太> <@田中太郎> 遺伝志休暇発信まであと1ヶ月です！30日後（7月15日）の24時まで`
- スレッドの URL が E 列に自動記録される

### 個人リマインドの場合（通常投稿）

**設定:**

```
期日: 2025-08-01
名前: 山田花子
リマインダー: 提出物リマインド
```

**結果:**

- 2025-07-25（7 日前）の **11時台** に `10_general` チャンネルに投稿
- メッセージ: `<@山田花子> 📋 提出をお願いします。7日後（8月1日）の24時まで`

## 🔧 テスト機能

実際にリマインドが送信される前に、テストで動作確認できます：

**現在の時間でテスト：**
1. Google Apps Script で `testReminder()` 関数を実行
2. 現在の時間に送信されるはずのリマインドがあれば、実際に送信される

**特定の時間でテスト：**
1. `testReminderAtHour(14)` のように時間を指定してテスト実行
2. 14時に送信されるリマインダーを強制的にテスト送信
3. ログで送信内容を確認可能

**例：**
```javascript
testReminderAtHour(9);  // 9時のリマインダーをテスト
testReminderAtHour(14); // 14時のリマインダーをテスト
```

## ❓ よくある質問

### Q: リマインダーを一時的に停止したい

A: 「リマインダー設定」シートで該当行を削除するか、別のシートに移動してください。

### Q: チャンネルを変更したい

A: D 列で別のチャンネルを選択するか、「全てのチャンネル」シートに新しいチャンネルを追加してください。

### Q: メッセージ内容を変更したい

A: 「リマインド文マスター」シートの D 列を編集してください。コードは一切触る必要ありません。

### Q: 新しいリマインダーを追加したい

A:

1. 「リマインド文マスター」に新しい行を追加
2. 「リマインダー設定」で対象者を設定
3. 自動でプルダウンに反映されます

### Q: スレッド機能はどのように動作しますか？

A: E列（スレッドリンク）の状況に応じて自動判定されます：
- **スレッドリンクがある場合**: そのスレッドに返信
- **スレッドリンクがない場合**: 新規投稿（セット名がある場合は自動でスレッドリンクを記録）

### Q: リマインダーの送信時間を変更したい

A: 「リマインド文マスター」のF列で送信時間を変更してください。24時間形式で入力（9=9時、14=14時）。

### Q: 全てのリマインダーを同じ時間に送信したい

A: リマインド文マスターのF列を全て同じ数字（例：9）にしてください。

### Q: 深夜や早朝に送信したい

A: F列に0-23の数字で指定可能です（0=深夜0時、6=朝6時、23=夜11時）。

## 🎯 使用のコツ

- **期日を正確に**: A 列の日付は必ず本番の日付を入力
- **プルダウンを活用**: C 列と D 列はプルダウンから選択で入力ミス防止
- **テストを活用**: 本番前に `testReminder()` でテスト実行
- **ログを確認**: Google Apps Script の実行ログで送信内容を確認可能
